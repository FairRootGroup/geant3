# $Id: MakeMacros,v 1.9 2004/11/26 16:54:51 brun Exp $

############################   MACROS   #######################################

$(DICT):
		@echo "Generating $@"
		@$(ROOT_BINDIR)/rootcint -f $@ -c $(filter -I%,$(CXXFLAGS)) $^

$(SLIBRARY):
		@echo "Generating $@"
		@[ -d $(dir $@) ] || mkdir -p $(dir $@)
		@rm -f $@
		@-rm -rf tmp
		@mkdir tmp
		@cd tmp ; find ../$(BINDIR) -name '*.o' -exec ln -s {} . \;
                ifeq ($(PLATFORM),aix)
		   @cd tmp; $(SHLD) -o $@ $(LIBS) -p 0 $(notdir $^)
                else
                   ifneq (,$(findstring macosx,$(PLATFORM)))
		      @cd tmp; $(SHLD) $(SOFLAGS) $(notdir $^) $(SHLIB) -o $@
                      ifneq (4,$(MACOSX_MINOR))
			@cd tmp; $(SHLD) -bundle -undefined dynamic_lookup $(notdir $^) $(SHLIB) -o $(subst .$(SL),.so,$@)
                      else
			@cd $(dir $@); rm -f $(notdir $(subst .$(SL),.so,$@)); ln -s $(notdir $@) $(notdir $(subst .$(SL),.so,$@))
                      endif
                   else
		      @cd tmp; $(SHLD) $(SOFLAGS) $(LDFLAGS) $(notdir $^) $(SHLIB) -o $@
                   endif
                endif
		@chmod 555 $@
		@-rm -rf tmp

$(ALIBRARY):	
		@echo "Generating $@"
		@[ -d $(dir $@) ] || mkdir -p $(dir $@)
		@rm -f $@
		@ar rv $@ $^

$(BINDIR)/$(TARGET):
		@echo "Generating $@"
		@[ -d $(dir $@) ] || mkdir $(dir $@)
		@rm -f $@
ifeq ($(CXXVERBOSE),)
		@$(LD) $(LDFLAGS) $^ $(LDLIBS) -o $@
else
		$(LD) $(LDFLAGS) $^ $(LDLIBS) -o $@
endif
 
$(EXEDIR)/$(TARGET): 
		@[ -d $(dir $@) ] || mkdir -p $(dir $@)
		@cp $(BINDIR)/$(TARGET) $(EXEDIR)
clean:
	rm -rf $(TOCLEAN)

cleanall:
	rm -rf $(TOCLEANALL)

depend:
		-@$(ROOT_BINDIR)/rmkdepend -f$(BINDIR)/Make-depend -p$(BINDIR)/ -- $(CXXFLAGS) $(DEPINC) -- $^ 2>/dev/null

$(BINDIR)/Make-depend:
		@[ -d $(dir $@) ] || mkdir $(dir $@)
		@cp $(CONFDIR)/Makedepend $@

dist:
	@$(MAKEDIST)

distclean:
	rm -rf $(TOCLEANALL) tgt_* lib/tgt_*

distsrc:
	@$(MAKEDISTSRC)

